---
title: "Agents"
description: "Personal planning agent and event-driven agent subsystem"
icon: "robot"
---

# Agent Subsystem

At the heart of cogmem-kos is the **Personal Planning Agent**—a cognitive agent with persistent, user-specific memory that orchestrates other specialized agents to complete complex tasks. This architecture addresses the critical limitation of current multi-agent frameworks: the lack of memory that enables learning and adaptation.

## The Personal Planning Agent

The personal planning agent is the **central orchestrator** of the cogmem-kos framework. Unlike traditional multi-agent systems that pass entire conversation histories through prompts, our planning agent:

<CardGroup cols={2}>
  <Card title="Persistent Memory" icon="brain">
    Maintains user-specific knowledge that persists across sessions
  </Card>
  <Card title="Contextual Planning" icon="map">
    Uses past experiences to create better action plans
  </Card>
  <Card title="Agent Orchestration" icon="sitemap">
    Coordinates specialized agents to execute complex tasks
  </Card>
  <Card title="Self-Improvement" icon="chart-line">
    Learns from completed actions to enhance future performance
  </Card>
</CardGroup>

```python
from kos.agents.planning.personal_planning_agent import PersonalPlanningAgent

agent = PersonalPlanningAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    memory_store=memory_store,
    llm_gateway=llm_gateway,
)

# Plan and execute a complex task
plan = await agent.create_plan(user_id, task_description)
result = await agent.execute_plan(plan)
```

## Design Principles

<CardGroup cols={2}>
  <Card title="Event-Driven" icon="bolt">
    Agents consume events from the outbox and emit new events
  </Card>
  <Card title="Idempotent" icon="repeat">
    Operations can be safely retried on failure
  </Card>
  <Card title="Provenance" icon="clock-rotate-left">
    Every action is logged for traceability
  </Card>
  <Card title="Composable" icon="puzzle-piece">
    Agents can be chained via event types
  </Card>
</CardGroup>

## Event Types

```python
class EventType(str, Enum):
    ITEM_UPSERTED = "item_upserted"
    ITEM_DELETED = "item_deleted"
    PASSAGES_CREATED = "passages_created"
    ENTITIES_EXTRACTED = "entities_extracted"
    VECTORS_CREATED = "vectors_created"
    TEXT_INDEXED = "text_indexed"
    ENTITY_PAGE_DIRTY = "entity_page_dirty"
```

## Core Agents

### PersonalPlanningAgent

The central orchestrator that plans and coordinates other agents.

| Property | Value |
|----------|-------|
| **Consumes** | `TASK_REQUESTED`, `PLAN_STEP_COMPLETED` |
| **Emits** | `PLAN_CREATED`, `AGENT_DISPATCHED` |
| **Writes to** | ObjectStore (plans, memories) |

```python
from kos.agents.planning.personal_planning_agent import PersonalPlanningAgent

agent = PersonalPlanningAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    memory_store=memory_store,
    llm_gateway=llm_gateway,
)
```

### ChunkAgent

Splits items into passages.

| Property | Value |
|----------|-------|
| **Consumes** | `ITEM_UPSERTED` |
| **Emits** | `PASSAGES_CREATED` |
| **Writes to** | ObjectStore (passages) |

```python
from kos.agents.ingest.chunk_agent import ChunkAgent

agent = ChunkAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    chunk_size=500,
    chunk_overlap=50,
)
```

### EmbedAgent

Generates embeddings for passages.

| Property | Value |
|----------|-------|
| **Consumes** | `PASSAGES_CREATED` |
| **Emits** | `VECTORS_CREATED` |
| **Writes to** | VectorSearchProvider |

```python
from kos.agents.enrich.embed_agent import EmbedAgent

agent = EmbedAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    vector_search=vector_search,
    embedder=embedder,
    batch_size=32,
)
```

### IndexTextAgent

Indexes passages in text search.

| Property | Value |
|----------|-------|
| **Consumes** | `PASSAGES_CREATED` |
| **Emits** | `TEXT_INDEXED` |
| **Writes to** | TextSearchProvider |

```python
from kos.agents.index.index_text_agent import IndexTextAgent

agent = IndexTextAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    text_search=text_search,
)
```

### EntityExtractAgent

Extracts named entities from passages.

| Property | Value |
|----------|-------|
| **Consumes** | `PASSAGES_CREATED` |
| **Emits** | `ENTITIES_EXTRACTED` |
| **Writes to** | ObjectStore (entities), GraphSearchProvider |

```python
from kos.agents.extract.entity_extract_agent import EntityExtractAgent

agent = EntityExtractAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    graph_search=graph_search,
    llm_gateway=llm_gateway,  # Optional
    use_llm=True,
)
```

### WikipediaPageAgent

Builds entity page artifacts.

| Property | Value |
|----------|-------|
| **Consumes** | `ENTITY_PAGE_DIRTY` |
| **Emits** | None |
| **Writes to** | ObjectStore (artifacts) |

```python
from kos.agents.curate.wikipedia_page_agent import WikipediaPageAgent

agent = WikipediaPageAgent(
    object_store=object_store,
    outbox_store=outbox_store,
    graph_search=graph_search,
    llm_gateway=llm_gateway,  # Optional for summaries
)
```

## Agent Pipeline

The Personal Planning Agent sits at the top of the hierarchy, orchestrating specialized agents:

```
                    TASK_REQUESTED
                          │
                          ▼
               ┌─────────────────────┐
               │ PersonalPlanningAgent│
               │   (orchestrator)    │
               └─────────────────────┘
                          │
            ┌─────────────┼─────────────┐
            ▼             ▼             ▼
      ITEM_UPSERTED  QUERY_NEEDED  ANALYSIS_NEEDED
            │
            ▼
    ┌─────────────┐
    │ ChunkAgent  │
    └─────────────┘
            │
            ▼
    PASSAGES_CREATED
            │
     ┌──────┼──────┬──────────────┐
     ▼      ▼      ▼              ▼
┌────────┐┌────────┐┌──────────────┐
│ Embed  ││ Index  ││ EntityExtract│
└────────┘└────────┘└──────────────┘
     │      │              │
     ▼      ▼              ▼
VECTORS  TEXT_IDX   ENTITIES_EXTRACTED
```

## Running Workers

```bash
# Start worker to process all events
kos run-worker

# With options
kos run-worker --poll-interval 1.0 --batch-size 10
```

## Creating Custom Agents

```python
from kos.agents.base import BaseAgent
from kos.core.events.event_types import EventType
from kos.core.events.envelope import EventEnvelope

class MyCustomAgent(BaseAgent):
    agent_id = "my_custom_agent"
    consumes_events = [EventType.PASSAGES_CREATED]
    
    async def process_event(self, event: EventEnvelope) -> list[EventEnvelope]:
        # Process the event
        passage_ids = event.payload.get("passage_ids", [])
        
        # Do work...
        
        # Log action for provenance
        await self.log_action(
            tenant_id=event.tenant_id,
            user_id=event.payload.get("user_id"),
            action_type="my_action",
            inputs=passage_ids,
            outputs=["output-1"],
        )
        
        # Optionally emit new events
        return []
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Retrieval Plans" icon="route" href="/architecture/retrieval-plans">
    See how agents feed retrieval
  </Card>
  <Card title="API Reference" icon="square-terminal" href="/api-reference/overview">
    Explore the API
  </Card>
</CardGroup>
